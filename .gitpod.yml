# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  - name: Setup Backend
    init: |
      pip install -r requirements.txt
      # You might want to add a command here to generate a SECRET_KEY in .env file if necessary
      python manage.py collectstatic --noinput
      python manage.py makemigrations --noinput
      python manage.py migrate --noinput
      python manage.py test
    command: |
      echo "To run the backend in DEBUG mode:"
      DEBUG=True python manage.py runserver
      echo "To run the backend in production mode:"
      echo "DEBUG=False uvicorn backend_lms.asgi:application --host 0.0.0.0 --port 8000 --workers 2"

  - name: Setup Frontend
    init: |
      cd ui/
      npm install -g pnpm
      pnpm i
      cp .env.example .env
      pnpm test
      pnpm build
    command: |
      echo "Frontend build complete. To start the dev server, run:"
      echo "cd ui && pnpm dev"

ports:
  - port: 8000
    onOpen: ignore
  - port: 5173
    onOpen: open-preview
